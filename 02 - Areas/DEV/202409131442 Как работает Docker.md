---
date:
  - 13/09/2024 14:42
tags:
  - docker
  - devops
  - info
cssclasses:
  - image-borders
  - neutral-pen-black
---
# Подробные заметки по Docker
- используется в сочетании с оркестраторами:
	- [**Kubernetes**](https://kubernetes.io/)
	- **[OpenShift](https://www.redhat.com/en/technologies/cloud-computing/openshift)**
- Разработан в <u>2008</u>, стал open-source в 2013
- С 2015 начал использовать собственную библиотеку libcontainer (сейчас [opencontainers/runc](https://github.com/opencontainers/runc)), после чего стал независимым
- Виртуализация на уровне ОС: среда запускается из ядра основной оси и использует ее ресурсы
- В поставку Docker входят следующие компоненты:
	- **Docker Host**: ОС/машина, на которой устанавливается и запускается Docker
	- **Docker daemon**: служба/движок/фоновый процесс, управляющая Docker-объектами: сетями: хранилищами, образами и контейнерами
	- **Docker client**: cli-клиент для взаимодействия с docker daemon, отправки команд и управления контейнерами
	- **Docker image**: неизменяемый образ, на основе которого разворачивается контейнер. Для создания многослойной структуры используется Union File System. По сути, каждый слой, это файл, который описывает изменение состояния образа в сравнение с моментом добавления предыдущего образа.
	- **Docker Container**: развернутое и запущенное приложение
		- Преимущества использования
			- **Изоляция**
			- **Портативность**
			- **Эффективность использования ресурсов в сравнении с виртуалками**
			- 
	- **Docker Registry**: репозиторий (от Docker или self-hosted), в котором хранятся образы
	- **[[202409160964 Dockerfile|Dockerfile]]**: файл-инструкция для сборки образа
	- **Docker Compose**: инструмент для управления несколькими контейнерами, их создания и конфигурации
	- **Docker Desktop**: GUI-клиент
	- Cхема архитектуры Docker![[Pasted image 20240913155737.png|Схема архитектуры Docker]]
- **Разницы виртуализации и контейнеризации**
- ![[Pasted image 20240916092718.png]]
- ![[Pasted image 20240916095107.png]]
	- **Виртуализация**
		- Реализуется на уровне железа
		- Полноценная ОС
		- Является частью физического сервера
	- Контейнеризация
		- Реализуется на уровне ОС
		- Способна запустить одно конкретное приложение
		- Потребляет меньше ресурсов
- **Преимущества Docker**
	- Изоляция приложений друг от друга
	- Портативность контейнеров, которые могут быть запущены на разных устройствах и системах
	- Эффективность используемых ресурсов, их разделение и менеджемент
	- Масштабируемость (небольшая, но все же)
	- Управление версиями
- **Минусы Docker**
	- **Высокое потребление ресурсов.** Он создает дополнительную логическую прослойку в ОС и потребляет доп. ресурсы.
	- **Для больших приложений нужен оркестратор**. Лучше всего пользоваться K8s
- Процесс во время запуска команды `docker run ubuntu /bin/bash`:
	- скачивается docker образ
	- создается контейнер
	- инициализируется файловая сисетма и монтируется read-only уровень
	- инициализируется сеть/мост: создается сетевой интерфейс который позволяет docker общаться с хост-машиной
	- устанавливается ip-адрес
	- запускается указанный процесс
	- Обрабатывается и выдается стандартный вход и выход потока логов приложения
- Технологи, используемые в docker
	- Какими пространствами имен пользуется docker для организации изолированных рабочих пространств:
		- `pid`: для изоляции процессов
		- `net`: для управления сетевыми интерфейсами
		- `ipc`: для управления IPC-устройствами (InterProcess Communication)
		- `mnt`: для управления точками монтирования
		- `utc`: для изолирования ядра и контроля генерации версий (Unix timesharing system)
	- Control groups (cgroups)
		- Ключ к работе приложения в изоляции, предоставлении приложению только тех ресурсов, которые ему нужно предоставить. Контрольные группы позволяют разделять доступные ресурсы железа и если необходимо, устанавливать пределы и ограничения.
		- Например, можно поставить ограничения по памяти в виде параметра `m`: `docker run -m 512m nginx`
		- Или же можно добавить мягкое ограничение в виде резервирования, которое добавить необходимое количество памяти в случае забития основного: `docker run -m 512m --memory-reservation=256m nginx`
		- С процессором такая же штука: `docker run --cpus=2 nginx`
		- Или же можно указать приоритет выделения ЦП. По умолчанию 1024. Чем выше значение, тем выше приоритет: `docker run --cpus=2 --cpu-shares=2000 nginx`.
	- Union File System
		- Файловая система, которая работает над созданием уровней для легковесной и быстрой работы. Docker может использовать несколько вариантов UnionFS: AUFS, btrfs, vfs, DeviceMapper
- Docker сочетает эти компоненты в обертку, называемую форматом контейнера (по умолчанию используется liccontainer)
- Возможности хранения данных в Docker
	- **Docker Volumes**. Тома — рекомендуемый способ хранения информации. Внутри лежат любые данные, и их (тома) можно подключать к разным контейнерам, выбирать спец. драйверы и хранить информацию не на хосте, а в облаке или на удаленном сервере.
	- **Bind Mount**. Более простой способ реализации — папки, которые монтируются к контейнеру прямо с хоста. Подойдет для передачи конфигов или в процессе разработки. Программист может писать код на хосте, а затем передавать его прямо в контейнер.
	- **Tmpfs (Linux Only)**. Специально отведенная область в оперативке, которая живет до момента остановки или перезапуска контейнера. Используется не для хранения данных, а для безопасности чувствительных данных.
	> Например, приложение в контейнере тормозит из-за того, что в ходе работы активно идут операции чтения-записи, а диски на хосте не очень быстрые. Если вы не уверены, в какой каталог идёт эта нагрузка, можно применить к запущенному контейнеру команду docker diff. И вот этот каталог смонтировать как tmpfs, таким образом перенеся ввод-вывод с диска в оперативную память.  
	> 
	> Такое хранилище может одновременно работать только с одним контейнером и доступно только в Linux.

	- **Named Pipes**. Именованные каналы, доступные только в Windows. 