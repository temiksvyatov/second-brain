---
date:
  - 04/09/2024 09:52
tags: 
cssclasses:
  - image-borders
  - neutral-pen-black
links: https://infocisco.ru/network_model_encapsulation_pdu.html
---
# Инкапсуляция
- Это процесс передачи данных сверху вниз по стеку протоколов.
- При взаимодействии, некоторые устройства могут использовать все 7 уровней, а некоторые меньше
  ![[Pasted image 20240904095703.png]]
- ## Инкапсуляция и декапсуляция

- Проще будет разобрать эти процессы инкапсуляции и декапсуляции на примере. Допустим, Вы захотели посмотреть какую-то веб-страничку, ввели в адресную строк браузера адрес сайта и нажали кнопку Enter. После этого браузер должен отправить запрос на сервер (на котором хранится эта веб-страничка), с целью получения данных. Вот как раз на этом этапе, введённый Вами адрес сайта является данными, которые должны передаться на сервер в виде запроса.

- [![Данные PDU 7 уровня модели OSI](https://infocisco.ru/articles/7_pdu_osi.png "Данные PDU 7 уровня модели OSI")](https://infocisco.ru/articles/7_pdu_osi.png)

- Эти данные опускаются с уровня приложений, на уровень представления данных.

- На этом уровне Ваш компьютер преобразует строку введенного текста (адреса) в формат удобный для передачи далее на нижний уровень.

- [![Данные PDU 6 уровня модели OSI](https://infocisco.ru/articles/6_pdu_osi.png "Данные PDU 6 уровня модели OSI")](https://infocisco.ru/articles/6_pdu_osi.png)

- Далее данные (уже не текст) поступают на сеансовый уровень, но на нём (в данном случае) нам нет необходимости использовать протоколы (этого уровня), и поэтому данные передаются далее.

- [![Данные PDU 5 уровня модели OSI](https://infocisco.ru/articles/5_pdu_osi.png "Данные PDU 5 уровня модели OSI")](https://infocisco.ru/articles/5_pdu_osi.png)

- Транспортный уровень получает данные и определяет, что дальше они должны быть переданы используя протокол TCP. Перед передачей транспортный уровень разбивает данные на кусочки данных и добавляет к каждому кусочку заголовок, в котором содержится информация о логических портах компьютеров (с какого данные были посланы (например 1223) и для какого предназначаются (в данном случае 80)). На транспортном уровне эти кусочки данных с заголовком называются сегментами. Сегменты передаются дальше вниз к сетевому уровню.

- [![Данные PDU 4 уровня модели OSI](https://infocisco.ru/articles/4_pdu_osi.png "Данные PDU 4 уровня модели OSI")](https://infocisco.ru/articles/4_pdu_osi.png)

- Сетевой уровень, получая каждый сегмент, разделяет его на еще более маленькие части и к каждой части добавляет свой заголовок. В заголовке сетевого уровня указываются логические сетевые адреса отправителя (Ваш компьютер) и получателя (Сервер).

- Логические сетевые адреса – это всем известные IP-адреса, еще наверное непонятно что обозначают цифры и точки в них, но вскоре, этот пробел в знаниях заполнит соответствующая информация ;)

- Эти маленькие кусочки данных уже с несколькими заголовками (на верхних уровнях тоже добавляются специфичные заголовки) на сетевом уровне называются пакетами, которые в свою очередь передаются на канальный уровень.

- [![Данные PDU 3 уровня модели OSI](https://infocisco.ru/articles/3_pdu_osi.png "Данные PDU 3 уровня модели OSI")](https://infocisco.ru/articles/3_pdu_osi.png)

- На канальном уровне пакеты разделяются на еще более маленькие кусочки данных, и к ним помимо опять добавляемого заголовка, только уже канального уровня, добавляется еще и трейлер. На этом уровне в заголовках содержатся физические адреса устройств – передающего и для кого они предназначаются, а в трейлере находится вычисленная контрольная сумма, некий код (информация), который используется для определения целостности данных.

- Физические адреса устройств – это MAC-адреса.

- Эти очень маленькие кусочки данных именуются кадрами или фреймами (одно и тоже). Далее кадры передаются на физический уровень.

- [![Данные PDU 2 уровня модели OSI](https://infocisco.ru/articles/2_pdu_osi.png "Данные PDU 2 уровня модели OSI")](https://infocisco.ru/articles/2_pdu_osi.png)

- На физический уровень кадры передаются уже в виде сигналов битов и следуют через другие сетевые устройства в пункт назначения.

- [![Данные PDU 1 уровня модели OSI](https://infocisco.ru/articles/1_pdu_osi.png "Данные PDU 1 уровня модели OSI")](https://infocisco.ru/articles/1_pdu_osi.png)

- Весь процесс преобразования данных (с верхнего уровня) в сигналы (на нижний уровень) называется инкапсуляцией. Посмотрите на рисунок ниже, там представлена общая схема инкапсулирования с верхнего уровня на нижний:

- [![Инкапсулирование данных PDU сетевой модели OSI](https://infocisco.ru/articles/encapsulation_pdu_osi.png "Инкапсулирование данных PDU сетевой модели OSI")](https://infocisco.ru/articles/encapsulation_pdu_osi.png)

- Далее сигналы, проходя через несколько сетевых устройств (в нашем случае это маршрутизатор и коммутатор), доходят до получателя, в данном случае до сервера (По всем картинкам можно кликнуть и они увеличится).

- [![Процесс передачи данных от одного компьютера к другому (серверу) через сетевые устройства (маршрутизатор и коммутатор)](https://infocisco.ru/articles/computer_marshrutizator_kommutator_computer.png "Процесс передачи данных от одного компьютера к другому (серверу) через сетевые устройства (маршрутизатор и коммутатор)")](https://infocisco.ru/articles/computer_marshrutizator_kommutator_computer.png)

- Сетевая карта сервера принимает биты (на физическом уровне) и преобразует их в кадры (для канального уровня). Канальный уровень в обратной последовательности должен преобразовать кадры в пакеты (для сетевого уровня), только перед преобразованием уровень сначала смотрит на МАС-адрес (физический адрес) получателя, он должен совпадать с MAC-адресом сетевой карты, иначе кадр будет уничтожен. Затем канальный уровень (в случае совпадения MAC-адреса) высчитывает сумму полученных данных и сравнивает полученное значение со значением трейлера. Напомню, что значение трейлера высчитывалось на Вашем компьютере, а теперь оно, после передачи по проводам, сравнивается с полученным значением на сервере и если они совпадают, кадр преобразуется в пакет. Если проверочный код целостности данных рознится – кадр незамедлительно уничтожается.

- На сетевом уровне происходит проверка логического адреса (IP-адреса), в случае успешной проверки пакет преобразуется в сегмент, попадая на транспортный уровень.

- На транспортном уровне проверяется информация из заголовка, что это за сегмент, какой используется протокол, для какого логического порта предназначается и т.п. Протокол использовался TCP, поэтому назад на Ваш компьютер посылается уведомление о прибытии сегмента. Как говорилось выше (когда данные упаковывали в сегмент) в том случае использовался 80 порт назначения. Т.к. на веб-сервере как раз открыт этот порт, данные передаются дальше на верхний уровень.

- На верхних уровнях запрос (введенный адрес сайта) обрабатывается веб-сервером (проверяется, доступна-ли запрашиваемая веб-страничка).

- Этот процесс преобразования сигналов из провода в данные называется процессом **декапсуляции**.

- После того, как страница будет найдена на сервере, она (текст, изображения, музыка) преобразуется в цифровой код, удобный для инкапсулирования. Большой объём данных делится на части и поступает ниже на уровень – транспортный. Там кусочек данных преобразуется в сегмент, только порт назначения теперь будет тот, с которого вы посылали (вспоминайте, 1223). Сегмент преобразуется в пакет, в заголовке которого содержится IP-адрес вашего компьютера и переходит ниже. На канальном уровне пакет в свою очередь преобразуется в кадры и добавляется заголовок и трейлер. В заголовок помещается МАС-адрес назначения (в данном случае это будет адрес шлюза), а в трейлер проверочный код на целостность данных. Далее сетевая карта посылает кадры в виде сигналов по кабелю по направлению к Вашему компьютеру.

- Так и происходит сетевой обмен данными, инкапсуляция и декапсуляция.

## PDU

- Вам обязательно надо запомнить, что те кусочки данных (вместе с заголовками), которые переходят с уровня на уровень (с добавлением заголовков или наоборот) называются **Protocol Data Unit или PDU**. Если перевести литературно на русский язык, то получается **фрагмент данных на каждом уровне модели**. В первой части CCNA попадаются вопросы связанные с PDU, так что обязательно запомните что это такое ;)